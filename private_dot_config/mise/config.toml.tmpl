[settings]
experimental = true
color_theme = "catppuccin"
idiomatic_version_file_enable_tools = ["python", "node"]
trusted_config_paths = ["{{ .chezmoi.homeDir }}/Documents/Projects", "/workspaces"]
lockfile = true

[settings.npm]
package_manager = "bun"

[settings.python]
uv_venv_auto = true

[shell_alias]
y = "yazi"
a = "atuin"
cm = "chezmoi"
d = "docker"
dc = "docker compose"
lg = "lazygit"
ld = "lazydocker"
lj = "lazyjournal"
oc = "opencode"
ts = "tailscale"
wgq = "wg-quick"
dump = "brew bundle dump --global --force"
la = "eza --long --icons --hyperlink --all --group-directories-first --smart-group --git --git-repos"
lt = "eza --long --icons --hyperlink --all --group-directories-first --git-ignore --ignore-glob=.git --smart-group --git --git-repos --tree --level"

[env]
_.path = [
    "{{ .chezmoi.homeDir }}/bin",
    "{{ .chezmoi.homeDir }}/.cargo/bin",
    "{{ .chezmoi.homeDir }}/go/bin",
    "$HOMEBREW_PREFIX/opt/ruby/bin",
    "$HOMEBREW_PREFIX/opt/llvm/bin"
]
SHELL = "fish"
PAGER = "bat"
EDITOR = "hx"
VISUAL = "hx"
XDG_CONFIG_HOME = "{{ .chezmoi.homeDir }}/.config"
XDG_CACHE_HOME = "{{ .chezmoi.homeDir }}/.cache"
XDG_DATA_HOME = "{{ .chezmoi.homeDir }}/.local/share"
XDG_STATE_HOME = "{{ .chezmoi.homeDir }}/.local/state"
MISE_GITHUB_TOKEN = { age = "YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBhblByQWUyQzdhalRYSVVBclcreEowS1VhbjdUbHIvNUN4Q2liZnhiSmhVClM4ZGZXQm1aWkFIRlRwQUZ6N2NBaDl5RXVSZndvdDM1cmV4VmQ3Y0Jubm8KLT4gc3NoLWVkMjU1MTkgaytYQ0RnIGNDTnRMMm9scnphSjZEbktqellBOWhvOGZpUVBRTS9BQTRTZy9JYnZEbHMKNVNiMTQ0ZndjSUdXRWh5dGFSK003dTZTZUNibnJZcUJGa2cxZUhtWDJ4VQotPiB3WW4+LWdyZWFzZSAqIjZWRWNdIHI+VTxDSSxoCjRNWFRwMGtJcWpIVVJlTk5NeHE5VDZMMUhkcHhiVWJXU3gwczRPQTA3WUV0WUlpd011S253cHZGZDYzalQxTmsKSUdueGZnCi0tLSAyWXVqNktxWll2RVJiTkJFemg3bzMxbVBsS1BuNG8rVWM0Vk43MUpNaUxjCn9flMcm8Rxd3E7gJtxbfwTxS7In2SwcLPhbK3WDVG0xFkgc8jYBsz2b78YyQIk7N96JkXQLm61WuY38aysrSqWFZdLxGv5KYA" }
GITHUB_TOKEN = { age = "YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBMYWVNMEw5Y1cxQVEybnBrakx6SElqRnhMenU5M2pGYVZJRUtvcEJIYzBBCmtnWkp0azhwTUJVRHl1cmR5Qks2cmNudHVoZTlQWlFETjJFeGFLaDN4Q00KLT4gc3NoLWVkMjU1MTkgaytYQ0RnIGJPUmRET3JSL0oySy9qYVk4VnpFelNXTld4R0g5U2hDbTNGUkJVZFJ0UWcKeERoa2xqM1hieGdmNEkxNC9wazdlZEduS0IxdDhlenhXTFpoVE94cUVKZwotPiB9UTd2aC1ncmVhc2UgQUtpeW8KQ1lyYlEzeWZ2VDVNUFQ3aGtFMFB2TU8rcy9XRU9TUWZBWC9DcFNNQ3BRCi0tLSA5OUZQWmZ2eXVFSFNOd09XR3VxWi9XSWpQc3F4VEdXMzhlMEt4NEczcU9nCgHiXyi+54dJqkYUbwr5/uI8Nt0TB302ggGQCmC8eSH4SXXLsxyNhHc63Pal7n9nz73OyrT2YCOYI231oyX+l25zuDTQN5eN7g" }
TS_AUTH_KEY = { age = "YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSArNVZhT0NKR1ZCNkdjTTNuZVQ4emVWdjFRaGlvTXhINmpXczd0Q3hVZEI0ClVPb2hrQkgyVVlod3BObmpnY1E3TCtVMnhzbDFVL2hob2xrSUsxNmNIWFEKLT4gc3NoLWVkMjU1MTkgaytYQ0RnIDlvMUg0cG5Dbm9DTmRiY1BHZ0FTeUpHbFhqaG0rL25KVm1ob28xd0xTeDQKOGFrVFVxU3MzWk9pK0NqUEpsVHA3MzRtSzdXUGh6T2NLQy9NUnVtYVYycwotPiBxLWdyZWFzZSB+SyQgXHYmRXpuIDJ6WQpva1lIRmZNSlRuQXhKbmw5djZhbkZ4bXB2c0RvRS9WR0NyMnZ5NTdQYzFxYytTY3JUb2NRblRVTmR3MVZMN3ZxCldvZGg1UWU4d294dHpEVm9NcXVXanFVUCtkUDFtOE9iTVphN1FnOXV5VVRMaG83WgotLS0gdVNuSW5IY1FYYVpIR1VDUVlMUkJJU29qUjMzQVNpdFBzQTAxMUtieCt6dwrqnn5EEjwFhz7oSRRuDVNwSFJWH3M9nv+ygbxceu7NG/nP677T45WpjT6u4qxU+USzjwoZb+WZ95nYfPKbMUcwB/vWtOIIwYXijxFe8SDmMEzWzIZCKloJv/zdbVQ" }
ATUIN_USERNAME = { age = "YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSB5SnZKcWpBcGRNMUt3cnpLeGlnM3JjT2tBMFNWOTdjK21jMk8weU5scUFrCndDQ0JLbkZsMGFRN3FoR1VocUM3eHk0eUg4RWJnMDZCSENMeXhhSVZ4RWsKLT4gc3NoLWVkMjU1MTkgaytYQ0RnIDlEQVJRZGJZeFhRNWorSTkwZlhhajRWZGVRZG82eTRsZ0FJK2wzNnkrRDgKdnB1SE9wSFA4c09Qb2cxYXUvRWt0RTlNTXNHb1BSaUdwNm1MRUs4aTZrOAotPiBDbmI5bDd1dy1ncmVhc2UgPVs2KXcrICd1IHxfTEpiIDd0V3sjCjR4VkFGaHhMQ0VQbktMVFdIeGV0ZW0yM0g5WHd3T29LdFJKcDd1eUZCMHd5R3FPZEFDblRUNFh0TTg2c3cySVAKL1pFOGNQdwotLS0gM2VzaW80ZTYzdHUxajhQTmp4dkhmaWpNeEtlZ25oTWprZTdCTDlKUWNtYwo1ge9eevEilHCu8CJQm+Uf4yB51W3COv3PBzDDY4laQqPcRZpbHmgDV7JH" }
ATUIN_PASSWORD = { age = "YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBwYlRZdkZzZW84dFFHRzJjc1NhUjdzeFQ1eEJ5UCtYZ0xoSmhSWmVBTzB3Cit5YnY5VFo5U0N4YmZPaXNyWG5aUWdzM25paHA0eFJhUHRmWkJTZVYyUnMKLT4gc3NoLWVkMjU1MTkgaytYQ0RnIDUzcGdzNjZSaUlaR0NWYlp1RTI1bEFMVEViVEdXaEY5dWl6bzV1YmN2MGMKMklwQXo3eVR6NldlaXVkS1diSzFwaDdKUDVPd3o1azc1Ty85L1JYSTVpOAotPiBsJS1ncmVhc2UgWGQsTGVwCkxtQ0pBQTQ4b2VXVUtiYW92TmJ1QkV2QkF0Y2ovRVgyMUxNeC90UjQrT0tDcU5yVW5WV0N3VDNMT2FxN1V5NFAKL2MwWlhBCi0tLSBuTlZFNU8vN3dORkNrYTlITjdNaVNRbVJxaEs1LzcyNUZUWWRPZ3I2TTlNCosSzR/jAqhjbEvCgL3yX85Z/w+uZJeGw8d2DQAGW9/phr/qpII2KYlQY1spwA8md+TiKAeFirieZkNLcv6C" }
ATUIN_KEY = { age = "YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBEdlcvOU0rZFd0STIzSzY2L2I3N1AzOHFUSDV3c29Sbm5SblpvcmVUWkZvCnk4Q3FYZm1oQk12SzU1UnA2MUJtalcrb0FqYlMzUGxhOUZ3bFVRUGJtcTAKLT4gc3NoLWVkMjU1MTkgaytYQ0RnIHBzcllCNG1DNkE5Y3diZmNVVTlUdFBxdFZyNE1wQUZPd1hsY3NYaDErWHMKV0NsWlUyRklEeUxGSFcwMlFRYVRZeHpGN1QvREEzZVVPYU5iUU9MZGVzQQotPiA9eyNULS1ncmVhc2UgfFRPIChBNmVJID5EOm52IVU7IHBwCnlvNlBjZVdTMytEQzRQdXRjanNSa0J6N3U3Zi9MM2NnMlJLRTJITEhKVzM3OXdjYUxTUnRwQkVjUVNXdjNyZwotLS0ga1ZUd3ZMNXhCWnNlYVhINWtpWGFQcWwwY01TN2pSWUtEQ05rdjFENk5sawqNTKXDynL1FprrjnLkuWbkhhdaZDp3nSlDce0+Dkf7OrbaPN2D7853WRxLAYivOukTV1mY22QSG8SaT/po9V+35wylxE8Cs662ETlCT4gJ6Q8THg1LePG2+UkBlGy2yMbV8yHM8+Lrh0S93/wSQsX6wKxA9AwBoKhkrOAWPp0kkvNQnAZHYanbV+QSPYlpKhTulDuPmvXMKzXWq2GrAK9kdYsdDGT3DZAsbsUaUiJoFF+K3h2vyLfM" }

[tools]
age = "latest"
ansible-core = "latest"
atuin = "latest"
bat = "latest"
biome = "latest"
bottom = "latest"
bun = "latest"
cargo-binstall = "latest"
"cargo:caligula" = "latest"
"cargo:commit-lsp" = "latest"
"cargo:systemd-lsp" = "latest"
chezmoi = "latest"
delta = "latest"
docker-cli = "latest"
docker-compose = "latest"
doggo = "latest"
dua = "latest"
eza = "latest"
fd = "latest"
fzf = "latest"
gemini-cli = "latest"
gh = "latest"
glow = "latest"
go = "latest"
"go:github.com/bootdotdev/bootdev" = "latest"
golangci-lint = "latest"
golangci-lint-langserver = "latest"
grex = "latest"
harper-ls = "latest"
helix = "latest"
helm = "latest"
helm-ls = "latest"
jbang = "latest"
jj = "latest"
jjui = "latest"
jq = "latest"
lazydocker = "latest"
lazygit = "latest"
lazyjournal = "latest"
lima = "latest"
marksman = "latest"
node = "latest"
oha = "latest"
op = "latest"
opencode = "latest"
opentofu = "latest"
pandoc = "latest"
prettier = "latest"
resvg = "latest"
ripgrep = "latest"
ruff = "latest"
rumdl = "latest"
rust = "latest"
scooter = "latest"
starship = "latest"
superhtml = "latest"
taplo = "latest"
terraform-ls = "latest"
tlrc = "latest"
tombi = "latest"
ty = "latest"
usage = "latest"
usql = "latest"
uv = "latest"
xh = "latest"
yamlfmt = "latest"
yazi = "latest"
zoxide = "latest"

[tasks."setup:packages"]
description = "Sync Homebrew and Mise packages"
run = [
    "brew bundle install --global --cleanup --force",
    "mise install"
]
sources = ["{{ .chezmoi.homeDir }}/.config/homebrew/Brewfile", "mise.lock"]

[tasks."setup:auth"]
description = "Authenticate services (Atuin, Tailscale)"
depends = ["setup:auth:atuin", "setup:auth:tailscale"]

[tasks."setup:auth:atuin"]
description = "Login to Atuin if not already logged in"
run = """
    atuin login --username "$ATUIN_USERNAME" --password "$ATUIN_PASSWORD" --key "$ATUIN_KEY" || echo "Atuin login skipped/failed"
    atuin sync
"""

[tasks."setup:auth:tailscale"]
description = "Authenticate Tailscale"
run = """
    if command -v tailscale >/dev/null; then
        sudo tailscale up --auth-key "$TS_AUTH_KEY" || true
    fi
"""

[tasks."setup:shell"]
description = "Configure Fish as the default shell"
run = """
    FISH_PATH="$(command -v fish)"
    if ! grep -q "$FISH_PATH" /etc/shells; then
        echo "Adding fish to /etc/shells..."
        echo "$FISH_PATH" | sudo tee -a /etc/shells
    fi
    if [[ "$SHELL" != "$FISH_PATH" ]]; then
        echo "Changing shell to fish..."
        sudo chsh -s "$FISH_PATH" "$USER"
    fi
"""

[tasks.setup]
description = "Run all setup tasks (Great for new machines)"
depends = ["setup:packages", "setup:auth", "setup:shell"]
